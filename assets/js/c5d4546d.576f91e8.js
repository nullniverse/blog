"use strict";(self.webpackChunknullniverseblog=self.webpackChunknullniverseblog||[]).push([[986],{6458:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>_,contentTitle:()=>a,default:()=>d,frontMatter:()=>r,metadata:()=>l,toc:()=>m});var i=t(4848),s=t(8453);const r={slug:"netwitness-parser-101",title:"Netwitness Integrations 101",authors:["nullniverse"],tags:["blogging","tool"]},a=void 0,l={permalink:"/netwitness-parser-101",source:"@site/blog/2024-08-03-netwitness-integrations-101/index.mdx",title:"Netwitness Integrations 101",description:"Collection of tips on how to create NetWitness integrations, mainly using 3rd-party APIs not currently (at the time of publishing, circa 2022) supported by the official release.",date:"2024-08-03T00:00:00.000Z",tags:[{label:"blogging",permalink:"/tags/blogging"},{label:"tool",permalink:"/tags/tool"}],readingTime:32.82,hasTruncateMarker:!0,authors:[{name:"Nullniverse",title:"Vassal @ \u7279\u8d38 Cyber",url:"https://github.com/nullniverse",imageURL:"https://github.com/nullniverse.png",key:"nullniverse"}],frontMatter:{slug:"netwitness-parser-101",title:"Netwitness Integrations 101",authors:["nullniverse"],tags:["blogging","tool"]},unlisted:!1,nextItem:{title:"Pod Recurrent Restarts via Cronjobs",permalink:"/pod-recurrent-restarts"}},_={authorsImageUrls:[void 0]},m=[{value:"Introduction",id:"introduction",level:2},{value:"Log Integration in RSA NetWitness",id:"log-integration-in-rsa-netwitness",level:2},{value:"How to Log Collect in NW",id:"how-to-log-collect-in-nw",level:3},{value:"Creating custom log collection and parsing",id:"creating-custom-log-collection-and-parsing",level:2},{value:"Example Parsers",id:"example-parsers",level:2},{value:"Tenable.io",id:"tenableio",level:3},{value:"TrendMicro",id:"trendmicro",level:3},{value:"References",id:"references",level:2}];function c(e){const n={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",hr:"hr",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components},{Details:r}=n;return r||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:(0,i.jsx)(n.em,{children:"Collection of tips on how to create NetWitness integrations, mainly using 3rd-party APIs not currently (at the time of publishing, circa 2022) supported by the official release."})}),"\n","\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Netwitness logo",src:t(2506).A+"",width:"555",height:"100"})}),"\n",(0,i.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,i.jsx)(n.p,{children:"This post compiles knowledge from the old times, when Netwitness still dominating the SIEM/Threat Intel arena and flowrished prior to the massive cloud-scale era."}),"\n",(0,i.jsx)(n.p,{children:"I did some work on the platform and I liked the architectural choices and its operations. I did some customizations as needed, and also built some integrations, mainly parsing for unsupported appliances from diverse vendors."}),"\n",(0,i.jsx)(n.p,{children:"Here I try my best to distill this information I've found useful and important at that time. Chances are nothing of it still works as-is, so do your due dilligence if you are touching the platform."}),"\n",(0,i.jsx)(n.h2,{id:"log-integration-in-rsa-netwitness",children:"Log Integration in RSA NetWitness"}),"\n",(0,i.jsx)(n.p,{children:"Sometimes, log integrations is a pain in the arse. Sometimes, you need to use any silvertape to glue the missing pieces together during your analysis due to the lack of a built-in native interface in the platform for easily integration."}),"\n",(0,i.jsxs)(n.p,{children:["The non-existent example of a simple REST plugin to pull data from APIs across different vendors if they are not readly ",(0,i.jsx)(n.a,{href:"https://community.netwitness.com/t5/netwitness-platform-integrations/tkb-p/netwitness-integrations",children:"supported"})," baffles the mind of the unsuspecting."]}),"\n",(0,i.jsxs)(n.p,{children:["This guide is intendend not only to provide some already integrations previously made by me, but to ",(0,i.jsx)(n.strong,{children:"guide"})," you in the path of log parser construction, by point out the fastest routes possible to get it done in a timely manner - because sometimes ",(0,i.jsx)(n.strong,{children:"Netwitness Community"})," is a very deep jungle with resources scattered here and there."]}),"\n",(0,i.jsx)(n.h3,{id:"how-to-log-collect-in-nw",children:"How to Log Collect in NW"}),"\n",(0,i.jsxs)(n.p,{children:["Netwitness provides ",(0,i.jsx)(n.a,{href:"https://community.netwitness.com/t5/netwitness-platform-online/log-collection-configuration/ta-p/669330",children:"distinct"})," ways of log collection that could be leveraged depending on your type of implementation."]}),"\n",(0,i.jsx)(n.p,{children:"As of version 11.5 and later, the allowed collection protocols still in use, are:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Check Point (OPSEC LEA)"}),"\n",(0,i.jsx)(n.li,{children:"File"}),"\n",(0,i.jsx)(n.li,{children:"Netflow"}),"\n",(0,i.jsx)(n.li,{children:"ODBC"}),"\n",(0,i.jsx)(n.li,{children:"Plugins (AWS Cloudtrail & Azure)"}),"\n",(0,i.jsx)(n.li,{children:"SDEE"}),"\n",(0,i.jsx)(n.li,{children:"SNMP Trap"}),"\n",(0,i.jsx)(n.li,{children:"Syslog"}),"\n",(0,i.jsx)(n.li,{children:"VMWare"}),"\n",(0,i.jsx)(n.li,{children:"Windows"}),"\n",(0,i.jsx)(n.li,{children:"Logstash"}),"\n",(0,i.jsx)(n.li,{children:"Windows Legacy"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["In many cases, your log source is sending to you using a combination of Syslog and ",(0,i.jsx)(n.a,{href:"https://www.crowdstrike.com/cybersecurity-101/observability/log-file-formats/#CEF",children:"CEF definitions"})," ",(0,i.jsx)(n.a,{href:"https://kc.mcafee.com/resources/sites/MCAFEE/content/live/CORP_KNOWLEDGEBASE/78000/KB78712/en_US/CEF_White_Paper_20100722.pdf",children:"e.g."}),", from which RSA NW has standard native support - unless your vendor don't deviates from standardized CEF notation."]}),"\n",(0,i.jsxs)(n.p,{children:["Even if that is true, you would end up needing a combination of Syslog and a custom way to parse your results received from Syslog, that arrives in a format not already supported or for which NW does not have any ",(0,i.jsx)(n.a,{href:"https://live.netwitness.rsa.com/registration/index.html",children:"Live"})," support. In such cases, the way to solve this headache is to make use of tools available by RSA itself. They are composed of the ",(0,i.jsx)(n.a,{href:"https://community.netwitness.com//t5/netwitness-platform-online/rsa-netwitness-log-parser-tool-v1-1-release-notes/ta-p/567402",children:"Log Parser Tool"})," and in the versions 11.5 and later, ",(0,i.jsx)(n.a,{href:"https://community.netwitness.com/t5/netwitness-platform-online/json-mappings/ta-p/669375",children:"JSON Mappings"}),", thich allow the parse of JSON messages arriving in the platform using a friendly UI."]}),"\n",(0,i.jsx)(n.p,{children:"In the following lines you'll know how to handle a custom implementation through the use of APIs provided by many vendors."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"creating-custom-log-collection-and-parsing",children:"Creating custom log collection and parsing"}),"\n",(0,i.jsx)(n.p,{children:"Your work may involve integration of some network devices, firewalls and security SaaS tools."}),"\n",(0,i.jsx)(n.p,{children:'I chose Python3 for quick deployment and easy maintenance. Python practitioners will find the code a little "disgraceful" but the aim is to avoid friction among team members whose experience with Python is little or nonexistent.'}),"\n",(0,i.jsx)(n.p,{children:"This type of integration is very simple:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Develop your API integration using any type of programming language of your choice."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Generate a log file, where each line represents an event collected via the API, and save the file in the path below, using ",(0,i.jsx)(n.a,{href:"https://www.youtube.com/watch?v=xK6XjzaWvX0",children:"Custom FileSpec"})," : ",(0,i.jsx)(n.code,{children:"/var/netwitness/logcollector/upload/<source_name>"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Once events are being received in the platform, proceed to generate the parser file."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["After the parser is generated, extracted and ",(0,i.jsx)(n.a,{href:"https://community.netwitness.com/t5/netwitness-community-blog/leveraging-rsa-live-to-deploy-custom-parsers-in-large/ba-p/519773",children:"installed"}),", ",(0,i.jsx)(n.a,{href:"https://community.netwitness.com/t5/netwitness-knowledge-base/how-to-add-custom-meta-keys-in-rsa-netwitness-platform/ta-p/677308",children:"adjust and add"})," custom meta keys as needed either by using ",(0,i.jsx)(n.a,{href:"https://github.com/nullniverse/netwitness-integrations/blob/main/etc/netwitness/ng/envision/etc/table-map-custom.xml",children:"this tool"})," for discovery, or these ",(0,i.jsx)(n.a,{href:"https://community.netwitness.com/t5/netwitness-knowledge-base/how-to-add-custom-meta-keys-in-rsa-netwitness-platform/ta-p/677308",children:"steps"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["a. Parsers can be restarted without reinitializing the entire application, see ",(0,i.jsx)(n.a,{href:"https://community.netwitness.com/t5/netwitness-knowledge-base/how-to-reload-parsers-on-a-decoder-or-log-decoder-via-the-rsa/ta-p/676949/redirect_from_archived_page/true",children:"here"})," for details."]}),"\n",(0,i.jsx)(n.p,{children:"b. After adjusting your index-concentrator-custom.xml and table-map-custom.xml a restart is needed in each service."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["That's it. I've tried to be as brief as possible. You can find a lot of resources below in the ",(0,i.jsx)(n.a,{href:"/netwitness-parser-101#references",children:"refs"}),". In the next topic I'll provide examples of parsers I've already made, feel free to use it as you want, hope it guides you in your parser journey. Peace be upon the traveler!"]}),"\n",(0,i.jsx)(n.h2,{id:"example-parsers",children:"Example Parsers"}),"\n",(0,i.jsx)(n.h3,{id:"tenableio",children:"Tenable.io"}),"\n",(0,i.jsxs)(r,{children:[(0,i.jsx)("summary",{children:"Example parser for Container Security using Python and a credential for authentication with the API."}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",metastring:'title="/opt/parsers/tenableio/creds/access_creds.json"',children:'{"access":"access-key here","secret":"secret-key here"}\n'})}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",metastring:'title="/opt/parsers/tenableio/container-security.py"',children:'import pprint, json, datetime, time, os.path\nfrom multiprocessing.context import assert_spawning\nfrom tenable.io import TenableIO\n\n# JSON PrettyPrinter Identation properties\npp = pprint.PrettyPrinter(indent=4)\n\n# Credentials load and definition\n\nwith open("/opt/parsers/tenableio/creds/access_creds.json", "r") as read_file:\n    data_json = json.load(read_file)\naccess_key = data_json["access"]\nsecret_key = data_json["secret"]\n\ntio = TenableIO(access_key, secret_key)\n\n# Path to send logs to\npath_dir = "/var/netwitness/logcollector/upload/tenableio/tenableio/"\nfilepath = os.path.join(path_dir, "container-security.log")\n\n# |-------------------------------------|\n# |------------- Tenable.IO ------------|\n# |------ Container Security Logs ------|\n# |-------------------------------------|\n\n# Check for problems\ndef has_problems(x, y):\n    if x > 0 or y > 0:\n      return  1\n    else:\n      return 0\n\n# Main function\ndef doit():\n\n    # Define `Now`\n    now_time = datetime.datetime.now().replace(microsecond=0).isoformat()\n\n    # Grab current image lists\n    images_list = tio.cs.images.list(return_json=True)\n\n    # Create "events" array of events\n    events = []\n\n    # If there are any images, proceed to next step...\n    if len(images_list["items"]) > 0:\n        \n        for item in images_list["items"]:\n        \n            # Print all images found - for Fast Debug only [Turn ON/OFF]\n            #\n            # print("repo: " +  item["repo_name"] + "name: " + item["name"] + " tag: " + item["tag"] +  " number_of_malware: " + str(item.number_of_malware) + " number_of_vulns: " + str(item.number_of_vulns))\n\n\n            # Check to see if any malware or vulnerabilities were found during the scan, if so, keep going...\n            eval_problems = has_problems(item.number_of_malware, item.number_of_vulns)\n            if eval_problems == 1:\n\n                # Predefine keys to use in "Reports" and "Image Details"\n                image_keys = {"repo_name": "", "name": "", "tag": ""}\n\n                image_keys["repo_name"] = item["repo_name"]\n                image_keys["name"] = item["name"]\n                image_keys["tag"] = item["tag"]\n\n\n                # Get image details\n\n                details = tio.cs.images.details(image_keys["repo_name"], image_keys["name"], image_keys["tag"])\n\n                # Image details information grab\n                digest = details["digest"]\n                last_scanned = details["last_scanned"]\n                uploaded_at = details["uploaded_at"]\n                risk_score = details.risk_score\n                status =  details["status"]\n                num_vulns = details.number_of_vulns\n                num_malware = details.number_of_malware\n                \n                \n                # Generate reports for the images that contains vulns or malwares\n                reports = tio.cs.reports.report(image_keys["repo_name"], image_keys["name"], image_keys["tag"])\n\n                # Define events counter and erase counter from previous "item"\n                count_probs = 0\n\n                # Clear previous message\n                message = ""\n\n                for report in reports["findings"]:\n                    \n                    count_probs += 1\n                    \n                    # Define log fields\n\n                    access_complexity = report["nvd_finding"]["access_complexity"]\n                    access_vector = report["nvd_finding"]["access_vector"]\n                    auth = report["nvd_finding"]["auth"]\n                    availability_impact = report["nvd_finding"]["availability_impact"]\n                    cfd_impact = report["nvd_finding"]["confidentiality_impact"]\n                    cve = report["nvd_finding"]["cve"]\n                    cvss_score = report["nvd_finding"]["cvss_score"]\n                    cvss_vector = report["nvd_finding"]["cvss_vector"]\n                    integrity_impact = report["nvd_finding"]["integrity_impact"]\n                    modified_date = report["nvd_finding"]["modified_date"]\n                    published_date = report["nvd_finding"]["published_date"]\n                    snyk_id = report["nvd_finding"]["snyk_id"]\n                    pkg_name = report["packages"][0]["name"]\n                    pkg_ver = report["packages"][0]["version"]\n                    pkg_type = report["packages"][0]["type"]\n\n                    # Create log message and append to "events" bucket\n                    message = str(now_time) + " customername.cloud.tenable.com, application=\\"container-security\\"" + ", " + "image_name=\\"" + image_keys["name"] + "\\", repo_name=\\"" + image_keys["repo_name"] + "\\", tag=\\"" + image_keys["tag"] + "\\", digest=\\"" + digest + "\\", risk_score=\\"" + str(risk_score) + "\\", status=\\"" + status + "\\", last_scanned=\\"" + last_scanned + "\\", uploaded_at=\\"" + uploaded_at + "\\", number_of_malware=\\"" + str(num_malware) + "\\", number_of_vulns=\\"" + str(num_vulns) + "\\", actual_vuln=\\"" + str(count_probs) + "\\", actual_malware=\\"" + str(num_malware) + "\\", access_complexity=\\"" + access_complexity + "\\", access_vector=\\"" + access_vector + "\\", auth=\\"" + auth + "\\", availability_impact=\\"" + availability_impact + "\\", cfd_impact=\\"" + cfd_impact + "\\", cve=\\"" + cve + "\\", cvss_score=\\"" + cvss_score + "\\", cvss_vector=\\"" + cvss_vector + "\\", integrity_impact=\\"" + integrity_impact + "\\", modified_date=\\"" + modified_date + "\\", published_date=\\"" + published_date + "\\", snyk_id=\\"" + snyk_id + "\\", pkg_name=\\"" + pkg_name + "\\", pkg_ver=\\"" + pkg_ver + "\\", pkg_type=\\"" + pkg_type + "\\""\n                    events.insert(-1, message)\n\n    # write events to the log file\n\n    for i in range(len(events)):\n        with open(filepath, "a+") as file_log:\n            file_log.seek(0)\n            data = file_log.read(100)\n            if len(data) > 0 :\n                file_log.write("\\n")\n            file_log.write(events[i])\n    print(len(events))\n\nif __name__ == "__main__":\n    doit()\n'})})]}),"\n",(0,i.jsx)(n.h3,{id:"trendmicro",children:"TrendMicro"}),"\n",(0,i.jsxs)(r,{children:[(0,i.jsx)("summary",{children:"Example parser for Cloud App using Python and a credential token for authentication with the API and the eventsource type specification."}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-xml",metastring:'title="/etc/netwitness/ng/logcollection/content/collection/file/trendcloudapp.xml"',children:'<?xml version="1.0" encoding="UTF-8"?>\n<typespec>\n\n   <name>trendcloudapp</name>\n   <type>file</type>\n   <prettyName>Trend Micro Cloud App Security</prettyName>\n   <version>1.0</version>\n   <author>administrator</author>\n   <description>FileCollection specification for eventsource type "Trend Micro Cloud App Security"</description>\n\n\t<device>\n\t\t<name>trendcloudapp</name>\n\t</device>\n\t\n\t<configuration>\n\t</configuration>\n\n\t<collection>\n\t        <file>\n                <parserId>trendcloudapp</parserId>\n                <processorType>generic</processorType>\n                <dataStartLine>1</dataStartLine>\n\t\t        <fieldDelim>,</fieldDelim>\n\t\t        <idField></idField>\n\t\t        <lineDelim>\\n</lineDelim>\n\t\t        <transformPrefixTag>trendcloudapp</transformPrefixTag>\n\t\t        <transformReplaceFieldDelim>0</transformReplaceFieldDelim>\n\t\t        <transformPrefixFilename>0</transformPrefixFilename>\n\t\t        <transformMultipleDelimiterAsOne>0</transformMultipleDelimiterAsOne>\n\t\t        <transformReplacementFieldDelim></transformReplacementFieldDelim>\n\t        </file>\n\t</collection>\n</typespec>\n'})}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",metastring:'title="/opt/tmcas/dlp-event-parser.py"',children:'###########################################################\n####                                                   ####\n#### Trend Micro Cloud App - DLP events                ####\n####                                                   ####\n####                                           ver.1.0 ####\n###########################################################\n\nimport requests, json, datetime, time, os.path, re\nimport dateutil.parser as dp\nfrom datetime import timedelta\n\n\n# path for testing\n\npath_dir = "/var/netwitness/logcollector/upload/trendcloudapp/trendcloudapp/"\nfilepath = os.path.join(path_dir, "dlp-events.log")\n\n# define services to be processed\nservices = ["exchange","teams","sharepoint","onedrive"]\n\ndef doit():\n\n    # open token file:\n    with open("token.json", "r") as read_file:\n        data_json = json.load(read_file)\n    token = data_json["access"]\n\n    # create \'next page link\' signaler\n    nxtlink = 0\n    url_maker_nxtlink = []\n\n    # format time interval and define the \'start\' and \'end\' ranges\n    now_log_time = datetime.datetime.now().replace(microsecond=0).isoformat(\' \')\n    now_time = datetime.datetime.now().replace(microsecond=0).isoformat()\n    previous_time = datetime.datetime.now() - timedelta(hours=1, minutes=0)\n    since = previous_time.strftime("%Y-%m-%dT%H:%M:%S.000%z") + \'Z\'\n    until = now_time + \'.000Z\'\n\n    # Start request message parameters\n    headers = {\n        \'Authorization\': \'Bearer \' + token,\n        \'cache-control\': \'no-cache\',\n    }\n\n    params = (\n    (\'start\', since),\n    (\'end\', until),\n    (\'limit\', \'200\'),\n    )\n\n    for sname in services:\n\n        # create event bucket and message var    \n        events = []\n        message = ""\n\n        # create the iterable URL and pass it to the API request\n        url_maker = "https://api.tmcas.trendmicro.com/siem/v1/security_events?service=" + sname + "&event=dlp"\n        print(url_maker)\n        response = requests.get(url_maker, headers=headers, params=params)\n\n        # work the deserialized response\n        current_incidents = json.loads(response.text)\n\n        # iterate in the response and format the log line message\n        if (len(current_incidents["security_events"]) > 0):\n            if (current_incidents["next_link"] != \'\'):\n                nxtlink = 1\n                url_maker_nxtlink.insert(-1, current_incidents["next_link"])\n\n            print(len(current_incidents["security_events"]))\n            for index in range(len(current_incidents["security_events"])):\n                for key in current_incidents["security_events"][index]:\n                    if key == "event":\n                        event_name = current_incidents["security_events"][index][key]\n                    elif key == "message":\n                        detection_time = current_incidents["security_events"][index][key]["detection_time"]\n                        file_name = current_incidents["security_events"][index][key]["file_name"]\n                        location = current_incidents["security_events"][index][key]["location"]\n                        triggered_policy_name = current_incidents["security_events"][index][key]["triggered_policy_name"]\n                        triggered_security_filter = current_incidents["security_events"][index][key]["triggered_security_filter"]\n                        action = current_incidents["security_events"][index][key]["action"]\n                        action_result = current_incidents["security_events"][index][key]["action_result"]\n                        violator = current_incidents["security_events"][index][key]["violator"]\n                        triggered_dlp_template = current_incidents["security_events"][index][key]["triggered_dlp_template"]\n                        violating_content = current_incidents["security_events"][index][key]["violating_content"]\n                        mail_message_id = current_incidents["security_events"][index][key]["mail_message_id"]\n                        mail_message_sender = current_incidents["security_events"][index][key]["mail_message_sender"]\n                        mail_message_recipient = current_incidents["security_events"][index][key]["mail_message_recipient"]\n                        mail_message_submit_time = current_incidents["security_events"][index][key]["mail_message_submit_time"]\n                        mail_message_delivery_time = current_incidents["security_events"][index][key]["mail_message_delivery_time"]\n                        mail_message_subject = current_incidents["security_events"][index][key]["mail_message_subject"]\n\n                    # log message creation\n\n                        # convert ISO8601 time format to unix timestamp\n\n                        dp_detectetime = dp.parse(detection_time)\n                        ut_detectedtime = int(time.mktime(dp_detectetime.timetuple()))\n                        ut_detectedtime = str(ut_detectedtime)\n\n                        dp_mail_submittime = dp.parse(mail_message_submit_time)\n                        ut_mail_submittime = int(time.mktime(dp_mail_submittime.timetuple()))\n                        ut_mail_submittime = str(ut_mail_submittime)\n                        \n                        dp_mail_deliverytime = dp.parse(mail_message_delivery_time)\n                        ut_mail_deliverytime = int(time.mktime(dp_mail_deliverytime.timetuple()))\n                        ut_mail_deliverytime = str(ut_mail_deliverytime)\n\n                        # extract mail_message_recipient\'s emails\n                        if len(mail_message_recipient) > 1:\n                            str_mail_message_recipient = \' \'.join([str(item) for item in mail_message_recipient])\n                            str_mail_message_recipient = str_mail_message_recipient.replace(\'\\"\', \'\')\n                            recipients_mail = re.findall(r\'[a-z0-9.\\-+_]+@[a-z0-9.\\-+_]+\\.[a-z]+\', str_mail_message_recipient)\n                            str_mail_message_recipient = \' \'.join([str(item) for item in recipients_mail])\n                        elif len(mail_message_recipient) == 1:\n                            str_mail_message_recipient = \' \'.join([str(item) for item in mail_message_recipient])\n\n                        # extract mail_message_sender\'s emails\n                        if len(mail_message_sender) > 1:\n                            str_mail_message_sender = \' \'.join([str(item) for item in mail_message_sender])\n                            str_mail_message_sender = str_mail_message_sender.replace(\'\\"\', \'\')\n                            senders_mail = re.findall(r\'[a-z0-9.\\-+_]+@[a-z0-9.\\-+_]+\\.[a-z]+\', str_mail_message_sender)\n                            str_mail_message_sender = \' \'.join([str(item) for item in senders_mail])\n                        elif len(mail_message_sender) == 1 | len(mail_message_sender) == 0 :\n                            str_mail_message_sender = \' \'.join([str(item) for item in mail_message_sender])\n\n                        # extract triggered_dlp_template\'s message\n                        if len(triggered_dlp_template) > 1:\n                            str_triggered_dlp_template = \' \'.join([str(item) for item in triggered_dlp_template])\n                            str_triggered_dlp_template = str_triggered_dlp_template.replace(\'\\"\', \'\')\n                        elif len(triggered_dlp_template) == 1 | len(triggered_dlp_template) == 0 :\n                            str_triggered_dlp_template = \' \'.join([str(item) for item in triggered_dlp_template])\n                            str_triggered_dlp_template = str_triggered_dlp_template.replace(\'\\"\', \'\')\n\n                        # clean up dangerous characters\n                        str_mail_message_recipient = str_mail_message_recipient.replace(\' \', \';\')\n                        str_triggered_dlp_template = triggered_dlp_template.replace(\',\', \';\')\n                        str_violating_content = violating_content.replace(\',\', \';\')\n                        str_file_name = file_name.replace(\',\', \';\')\n                        str_mail_message_subject = mail_message_subject.replace(\',\', \';\')\n                        str_mail_message_sender = mail_message_sender.replace(\'\\"\', \'\')\n\n                        # main message creation\n                        message = str(now_log_time) + " tmcas.customername.com, application=\\"tmcas-" + sname + "-"+ event_name + "\\", detectedutc=\\"" + ut_detectedtime + "\\", file_name=\\"" + str_file_name + "\\", violator=\\"" + violator + "\\", location=\\"" + location + "\\", triggered_policy_name=\\"" + triggered_policy_name + "\\", triggered_security_filter=\\"" + triggered_security_filter + "\\", action=\\"" + action + "\\", action_result=\\"" + action_result + "\\", mail_message_id=\\"" + mail_message_id + "\\", mail_message_sender=\\"" + str_mail_message_sender + "\\", mail_message_recipient=\\"" + str_mail_message_recipient + "\\", mail_message_submit_time=\\"" + ut_mail_submittime + "\\", mail_message_delivery_time=\\"" + ut_mail_deliverytime + "\\", mail_message_subject=\\"" + str_mail_message_subject + "\\", triggered_dlp_template=\\"" + str_triggered_dlp_template +  "\\", violating_content=\\"" + str_violating_content + "\\""\n\n                        events.insert(-1, message)\n\n    # write events to the log file \n\n        for i in range(len(events)):\n            with open(filepath, "a+") as file_log:\n                file_log.seek(0)\n                data = file_log.read(100)\n                if len(data) > 0 :\n                    file_log.write("\\n")\n                file_log.write(events[i])\n        print(len(events))\n\n    # check if there are a new page of events for being processed, then do it!\n    if (nxtlink == 1):\n        for url in url_maker_nxtlink:\n\n            # restate event bucket and message var    \n            events = []\n            message = ""\n            \n            print(url)\n            print(len(url_maker_nxtlink))\n            response = requests.get(url, headers=headers, params=params)\n\n            # work the deserialized response\n            current_incidents = json.loads(response.text)\n\n            # iterate in the response and format the log line message\n            if (len(current_incidents["security_events"]) > 0):\n\n                if (current_incidents["next_link"] != \'\'):\n                    url_maker_nxtlink.insert(-1, current_incidents["next_link"])\n\n                print(len(current_incidents["security_events"]))\n                for index in range(len(current_incidents["security_events"])):\n                    for key in current_incidents["security_events"][index]:\n                        if key == "event":\n                            event_name = current_incidents["security_events"][index][key]\n                        elif key == "message":\n                            detection_time = current_incidents["security_events"][index][key]["detection_time"]\n                            file_name = current_incidents["security_events"][index][key]["file_name"]\n                            location = current_incidents["security_events"][index][key]["location"]\n                            triggered_policy_name = current_incidents["security_events"][index][key]["triggered_policy_name"]\n                            triggered_security_filter = current_incidents["security_events"][index][key]["triggered_security_filter"]\n                            action = current_incidents["security_events"][index][key]["action"]\n                            action_result = current_incidents["security_events"][index][key]["action_result"]\n                            violator = current_incidents["security_events"][index][key]["violator"]\n                            triggered_dlp_template = current_incidents["security_events"][index][key]["triggered_dlp_template"]\n                            violating_content = current_incidents["security_events"][index][key]["violating_content"]\n                            mail_message_id = current_incidents["security_events"][index][key]["mail_message_id"]\n                            mail_message_sender = current_incidents["security_events"][index][key]["mail_message_sender"]\n                            mail_message_recipient = current_incidents["security_events"][index][key]["mail_message_recipient"]\n                            mail_message_submit_time = current_incidents["security_events"][index][key]["mail_message_submit_time"]\n                            mail_message_delivery_time = current_incidents["security_events"][index][key]["mail_message_delivery_time"]\n                            mail_message_subject = current_incidents["security_events"][index][key]["mail_message_subject"]\n\n                        # log message creation\n\n                            # convert ISO8601 time format to unix timestamp\n\n                            dp_detectetime = dp.parse(detection_time)\n                            ut_detectedtime = int(time.mktime(dp_detectetime.timetuple()))\n                            ut_detectedtime = str(ut_detectedtime)\n\n                            dp_mail_submittime = dp.parse(mail_message_submit_time)\n                            ut_mail_submittime = int(time.mktime(dp_mail_submittime.timetuple()))\n                            ut_mail_submittime = str(ut_mail_submittime)\n                            \n                            dp_mail_deliverytime = dp.parse(mail_message_delivery_time)\n                            ut_mail_deliverytime = int(time.mktime(dp_mail_deliverytime.timetuple()))\n                            ut_mail_deliverytime = str(ut_mail_deliverytime)\n\n                            # extract mail_message_recipient\'s emails\n                            if len(mail_message_recipient) > 1:\n                                str_mail_message_recipient = \' \'.join([str(item) for item in mail_message_recipient])\n                                str_mail_message_recipient = str_mail_message_recipient.replace(\'\\"\', \'\')\n                                recipients_mail = re.findall(r\'[a-z0-9.\\-+_]+@[a-z0-9.\\-+_]+\\.[a-z]+\', str_mail_message_recipient)\n                                str_mail_message_recipient = \' \'.join([str(item) for item in recipients_mail])\n                            elif len(mail_message_recipient) == 1:\n                                str_mail_message_recipient = \' \'.join([str(item) for item in mail_message_recipient])\n\n                            # extract mail_message_sender\'s emails\n                            if len(mail_message_sender) > 1:\n                                str_mail_message_sender = \' \'.join([str(item) for item in mail_message_sender])\n                                str_mail_message_sender = str_mail_message_sender.replace(\'\\"\', \'\')\n                                senders_mail = re.findall(r\'[a-z0-9.\\-+_]+@[a-z0-9.\\-+_]+\\.[a-z]+\', str_mail_message_sender)\n                                str_mail_message_sender = \' \'.join([str(item) for item in senders_mail])\n                            elif len(mail_message_sender) == 1 | len(mail_message_sender) == 0 :\n                                str_mail_message_sender = \' \'.join([str(item) for item in mail_message_sender])\n\n                            # extract triggered_dlp_template\'s message\n                            if len(triggered_dlp_template) > 1:\n                                str_triggered_dlp_template = \' \'.join([str(item) for item in triggered_dlp_template])\n                                str_triggered_dlp_template = str_triggered_dlp_template.replace(\'\\"\', \'\')\n                            elif len(triggered_dlp_template) == 1 | len(triggered_dlp_template) == 0 :\n                                str_triggered_dlp_template = \' \'.join([str(item) for item in triggered_dlp_template])\n                                str_triggered_dlp_template = str_triggered_dlp_template.replace(\'\\"\', \'\')\n\n                            # clean up dangerous characters\n                            str_mail_message_recipient = str_mail_message_recipient.replace(\' \', \';\')\n                            str_triggered_dlp_template = triggered_dlp_template.replace(\',\', \';\')\n                            str_violating_content = violating_content.replace(\',\', \';\')\n                            str_file_name = file_name.replace(\',\', \';\')\n                            str_mail_message_subject = mail_message_subject.replace(\',\', \';\')\n                            str_mail_message_sender = mail_message_sender.replace(\'\\"\', \'\')\n\n                            # main message creation\n                            message = str(now_log_time) + " tmcas.customername.com, application=\\"tmcas-" + sname + "-"+ event_name + "\\", detectedutc=\\"" + ut_detectedtime + "\\", file_name=\\"" + str_file_name + "\\", violator=\\"" + violator + "\\", location=\\"" + location + "\\", triggered_policy_name=\\"" + triggered_policy_name + "\\", triggered_security_filter=\\"" + triggered_security_filter + "\\", action=\\"" + action + "\\", action_result=\\"" + action_result + "\\", mail_message_id=\\"" + mail_message_id + "\\", mail_message_sender=\\"" + str_mail_message_sender + "\\", mail_message_recipient=\\"" + str_mail_message_recipient + "\\", mail_message_submit_time=\\"" + ut_mail_submittime + "\\", mail_message_delivery_time=\\"" + ut_mail_deliverytime + "\\", mail_message_subject=\\"" + str_mail_message_subject + "\\", triggered_dlp_template=\\"" + str_triggered_dlp_template +  "\\", violating_content=\\"" + str_violating_content + "\\""\n\n                            events.insert(-1, message)\n\n        # write events to the log file \n            for i in range(len(events)):\n                with open(filepath, "a+") as file_log:\n                \n                    file_log.seek(0)\n                    data = file_log.read(100)\n                    if len(data) > 0 :\n                        file_log.write("\\n")\n                    file_log.write(events[i])\n            print(len(events))\n\nif __name__ == "__main__":\n    while True:\n        doit()\n        time.sleep(300)\n'})}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",metastring:'title="/opt/tmcas/ransomware-event-parser.py"',children:'###########################################################\n####                                                   ####\n#### Trend Micro Cloud App - Ransomware events         ####\n####                                                   ####\n####                                           ver.1.0 ####\n###########################################################\n\n\nimport requests, json, datetime, time, os.path, re\nimport dateutil.parser as dp\nfrom datetime import timedelta\n\n# path for testing\n\npath_dir = "/var/netwitness/logcollector/upload/trendcloudapp/trendcloudapp/"\nfilepath = os.path.join(path_dir, "ransomware-events.log")\n\n\n# define services to be processed\nservices = ["exchange","teams","sharepoint","onedrive"]\n\n\ndef doit():\n\n    # open token file:\n    with open("token.json", "r") as read_file:\n        data_json = json.load(read_file)\n    token = data_json["access"]\n\n\n    # create \'next page link\' signaler\n    nxtlink = 0\n    url_maker_nxtlink = []\n\n\n    # format time interval and define the \'start\' and \'end\' ranges\n    now_log_time = datetime.datetime.now().replace(microsecond=0).isoformat(\' \')\n    now_time = datetime.datetime.now().replace(microsecond=0).isoformat()\n    previous_time = datetime.datetime.now() - timedelta(hours=1, minutes=0)\n    since = previous_time.strftime("%Y-%m-%dT%H:%M:%S.000%z") + \'Z\'\n    until = now_time + \'.000Z\'\n\n\n    # Start request message parameters\n    headers = {\n        \'Authorization\': \'Bearer \' + token,\n        \'cache-control\': \'no-cache\',\n    }\n\n    params = (\n    (\'start\', since),\n    (\'end\', until),\n    (\'limit\', \'200\'),\n    )\n\n    for sname in services:\n\n        # create event bucket and message var    \n        events = []\n        message = ""\n        \n        # create the iterable URL and pass it to the API request\n        url_maker = "https://api.tmcas.trendmicro.com/siem/v1/security_events?service=" + sname + "&event=ransomware"\n        print(url_maker)\n        response = requests.get(url_maker, headers=headers, params=params)\n\n        # work the deserialized response\n        current_incidents = json.loads(response.text)\n\n        # iterate in the response and format the log line message\n        if (len(current_incidents["security_events"]) > 0):\n            if (current_incidents["next_link"] != \'\'):\n                nxtlink = 1\n                url_maker_nxtlink.insert(-1, current_incidents["next_link"])\n\n            print(len(current_incidents["security_events"]))\n            for index in range(len(current_incidents["security_events"])):\n                for key in current_incidents["security_events"][index]:\n                    if key == "event":\n                        event_name = current_incidents["security_events"][index][key]\n                    elif key == "message":\n                        detection_time = current_incidents["security_events"][index][key]["detection_time"]\n                        mail_message_recipient = current_incidents["security_events"][index][key]["mail_message_recipient"]\n                        scan_type = current_incidents["security_events"][index][key]["scan_type"]\n                        affected_user = current_incidents["security_events"][index][key]["affected_user"]\n                        location = current_incidents["security_events"][index][key]["location"]\n                        triggered_policy_name = current_incidents["security_events"][index][key]["triggered_policy_name"]\n                        triggered_security_filter = current_incidents["security_events"][index][key]["triggered_security_filter"]\n                        action = current_incidents["security_events"][index][key]["action"]\n                        action_result = current_incidents["security_events"][index][key]["action_result"]\n                        mail_message_id = current_incidents["security_events"][index][key]["mail_message_id"]\n                        mail_message_sender = current_incidents["security_events"][index][key]["mail_message_sender"]\n                        mail_message_submit_time = current_incidents["security_events"][index][key]["mail_message_submit_time"]\n                        mail_message_delivery_time = current_incidents["security_events"][index][key]["mail_message_delivery_time"]\n                        mail_message_subject = current_incidents["security_events"][index][key]["mail_message_subject"]\n                        mail_message_file_name = current_incidents["security_events"][index][key]["mail_message_file_name"]\n                        ransomware_name = current_incidents["security_events"][index][key]["ransomware_name"]\n\n                    # log message creation\n\n                        # convert ISO8601 time format to unix timestamp\n\n                        dp_detectetime = dp.parse(detection_time)\n                        ut_detectedtime = int(time.mktime(dp_detectetime.timetuple()))\n                        ut_detectedtime = str(ut_detectedtime)\n\n                        dp_mail_submittime = dp.parse(mail_message_submit_time)\n                        ut_mail_submittime = int(time.mktime(dp_mail_submittime.timetuple()))\n                        ut_mail_submittime = str(ut_mail_submittime)\n                        \n                        dp_mail_deliverytime = dp.parse(mail_message_delivery_time)\n                        ut_mail_deliverytime = int(time.mktime(dp_mail_deliverytime.timetuple()))\n                        ut_mail_deliverytime = str(ut_mail_deliverytime)\n\n                        # extract mail_message_recipient\'s emails\n                        if len(mail_message_recipient) > 1:\n                            str_mail_message_recipient = \' \'.join([str(item) for item in mail_message_recipient])\n                            str_mail_message_recipient = str_mail_message_recipient.replace(\'\\"\', \'\')\n                            recipients_mail = re.findall(r\'[a-z0-9.\\-+_]+@[a-z0-9.\\-+_]+\\.[a-z]+\', str_mail_message_recipient)\n                            str_mail_message_recipient = \' \'.join([str(item) for item in recipients_mail])\n                        elif len(mail_message_recipient) == 1:\n                            str_mail_message_recipient = \' \'.join([str(item) for item in mail_message_recipient])\n                        \n                        # clean up dangerous characters\n                        str_mail_message_recipient = str_mail_message_recipient.replace(\' \', \';\')\n                        str_mail_message_file_name = mail_message_file_name.replace(\',\', \';\')\n                        str_mail_message_subject = mail_message_subject.replace(\',\', \';\')\n                        str_mail_message_sender = mail_message_sender.replace(\'\\"\', \'\')\n\n                        # main message creation\n                        message = str(now_log_time) + " tmcas.customername.com, application=\\"tmcas-" + sname + "-"+ event_name + "\\", detectedutc=\\"" + ut_detectedtime + "\\", scan_type=\\"" + scan_type + "\\", affected_user=\\"" + affected_user + "\\", location=\\"" + location + "\\", triggered_policy_name=\\"" + triggered_policy_name + "\\", triggered_security_filter=\\"" + triggered_security_filter + "\\", action=\\"" + action + "\\", action_result=\\"" + action_result + "\\", mail_message_id=\\"" + mail_message_id + "\\", mail_message_sender=\\"" + str_mail_message_sender + "\\", mail_message_recipient=\\"" + str_mail_message_recipient + "\\", mail_message_submit_time=\\"" + ut_mail_submittime + "\\", mail_message_delivery_time=\\"" + ut_mail_deliverytime + "\\", mail_message_subject=\\"" + str_mail_message_subject + "\\", mail_message_file_name=\\"" + str_mail_message_file_name + "\\", ransomware_name=\\"" + ransomware_name + "\\""\n\n                        events.insert(-1, message)\n\n    # write events to the log file \n\n        for i in range(len(events)):\n            with open(filepath, "a+") as file_log:\n                file_log.seek(0)\n                data = file_log.read(100)\n                if len(data) > 0 :\n                    file_log.write("\\n")\n                file_log.write(events[i])\n        print(len(events))\n\n    # check if there are a new page of events for being processed, then do it!\n    if (nxtlink == 1):\n        for url in url_maker_nxtlink:\n\n            # restate event bucket and message var    \n            events = []\n            message = ""\n            \n            print(url)\n            print(len(url_maker_nxtlink))\n            response = requests.get(url, headers=headers, params=params)\n\n            # work the deserialized response\n            current_incidents = json.loads(response.text)\n\n            # iterate in the response and format the log line message\n            if (len(current_incidents["security_events"]) > 0):\n\n                if (current_incidents["next_link"] != \'\'):\n                    url_maker_nxtlink.insert(-1, current_incidents["next_link"])\n\n                print(len(current_incidents["security_events"]))\n                for index in range(len(current_incidents["security_events"])):\n                    for key in current_incidents["security_events"][index]:\n                        if key == "event":\n                            event_name = current_incidents["security_events"][index][key]\n                        elif key == "message":\n                            detection_time = current_incidents["security_events"][index][key]["detection_time"]\n                            mail_message_recipient = current_incidents["security_events"][index][key]["mail_message_recipient"]\n                            scan_type = current_incidents["security_events"][index][key]["scan_type"]\n                            affected_user = current_incidents["security_events"][index][key]["affected_user"]\n                            location = current_incidents["security_events"][index][key]["location"]\n                            triggered_policy_name = current_incidents["security_events"][index][key]["triggered_policy_name"]\n                            triggered_security_filter = current_incidents["security_events"][index][key]["triggered_security_filter"]\n                            action = current_incidents["security_events"][index][key]["action"]\n                            action_result = current_incidents["security_events"][index][key]["action_result"]\n                            mail_message_id = current_incidents["security_events"][index][key]["mail_message_id"]\n                            mail_message_sender = current_incidents["security_events"][index][key]["mail_message_sender"]\n                            mail_message_submit_time = current_incidents["security_events"][index][key]["mail_message_submit_time"]\n                            mail_message_delivery_time = current_incidents["security_events"][index][key]["mail_message_delivery_time"]\n                            mail_message_subject = current_incidents["security_events"][index][key]["mail_message_subject"]\n                            mail_message_file_name = current_incidents["security_events"][index][key]["mail_message_file_name"]\n                            ransomware_name = current_incidents["security_events"][index][key]["ransomware_name"]\n\n                        # log message creation\n\n                            # convert ISO8601 time format to unix timestamp\n\n                            dp_detectetime = dp.parse(detection_time)\n                            ut_detectedtime = int(time.mktime(dp_detectetime.timetuple()))\n                            ut_detectedtime = str(ut_detectedtime)\n\n                            dp_mail_submittime = dp.parse(mail_message_submit_time)\n                            ut_mail_submittime = int(time.mktime(dp_mail_submittime.timetuple()))\n                            ut_mail_submittime = str(ut_mail_submittime)\n                            \n                            dp_mail_deliverytime = dp.parse(mail_message_delivery_time)\n                            ut_mail_deliverytime = int(time.mktime(dp_mail_deliverytime.timetuple()))\n                            ut_mail_deliverytime = str(ut_mail_deliverytime)\n\n                            # extract mail_message_recipient\'s emails\n                            if len(mail_message_recipient) > 1:\n                                str_mail_message_recipient = \' \'.join([str(item) for item in mail_message_recipient])\n                                str_mail_message_recipient = str_mail_message_recipient.replace(\'\\"\', \'\')\n                                recipients_mail = re.findall(r\'[a-z0-9.\\-+_]+@[a-z0-9.\\-+_]+\\.[a-z]+\', str_mail_message_recipient)\n                                str_mail_message_recipient = \' \'.join([str(item) for item in recipients_mail])\n                            elif len(mail_message_recipient) == 1:\n                                str_mail_message_recipient = \' \'.join([str(item) for item in mail_message_recipient])\n                            \n                            \n                            # clean up dangerous characters\n                            str_mail_message_recipient = str_mail_message_recipient.replace(\' \', \';\')\n                            str_mail_message_file_name = mail_message_file_name.replace(\',\', \';\')\n                            str_mail_message_subject = mail_message_subject.replace(\',\', \';\')\n                            str_mail_message_sender = mail_message_sender.replace(\'\\"\', \'\')\n\n                            # main message creation\n                            message = str(now_log_time) + " tmcas.customername.com, application=\\"tmcas-" + sname + "-"+ event_name + "\\", detectedutc=\\"" + ut_detectedtime + "\\", scan_type=\\"" + scan_type + "\\", affected_user=\\"" + affected_user + "\\", location=\\"" + location + "\\", triggered_policy_name=\\"" + triggered_policy_name + "\\", triggered_security_filter=\\"" + triggered_security_filter + "\\", action=\\"" + action + "\\", action_result=\\"" + action_result + "\\", mail_message_id=\\"" + mail_message_id + "\\", mail_message_sender=\\"" + str_mail_message_sender + "\\", mail_message_recipient=\\"" + str_mail_message_recipient + "\\", mail_message_submit_time=\\"" + ut_mail_submittime + "\\", mail_message_delivery_time=\\"" + ut_mail_deliverytime + "\\", mail_message_subject=\\"" + str_mail_message_subject + "\\", mail_message_file_name=\\"" + str_mail_message_file_name + "\\", ransomware_name=\\"" + ransomware_name + "\\""\n\n                            events.insert(-1, message)\n\n        # write events to the log file \n            for i in range(len(events)):\n                with open(filepath, "a+") as file_log:\n                \n                    file_log.seek(0)\n                    data = file_log.read(100)\n                    if len(data) > 0 :\n                        file_log.write("\\n")\n                    file_log.write(events[i])\n            print(len(events))\n\nif __name__ == "__main__":\n    while True:\n        doit()\n        time.sleep(300)\n'})}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",metastring:'title="/opt/tmcas/securityrisk-event-parser.py"',children:'###########################################################\n####                                                   ####\n#### Trend Micro Cloud App - Security Risk events      ####\n####                                                   ####\n####                                           ver.1.0 ####\n###########################################################\n\nimport requests, json, datetime, time, os.path, re\nimport dateutil.parser as dp\nfrom datetime import timedelta\n\n# path for testing\n\npath_dir = "/var/netwitness/logcollector/upload/trendcloudapp/trendcloudapp/"\nfilepath = os.path.join(path_dir, "securityrisk-events.log")\n\n\n# define services to be processed\nservices = ["exchange","teams","sharepoint","onedrive"]\n\n\ndef doit():\n\n    # open token file:\n    with open("token.json", "r") as read_file:\n        data_json = json.load(read_file)\n    token = data_json["access"]\n\n    # create \'next page link\' signaler\n    nxtlink = 0\n    url_maker_nxtlink = []\n\n    # format time interval and define the \'start\' and \'end\' ranges\n    now_log_time = datetime.datetime.now().replace(microsecond=0).isoformat(\' \')\n    now_time = datetime.datetime.now().replace(microsecond=0).isoformat()\n    previous_time = datetime.datetime.now() - timedelta(hours=0, minutes=30)\n    since = previous_time.strftime("%Y-%m-%dT%H:%M:%S.000%z") + \'Z\'\n    until = now_time + \'.000Z\'\n\n    # Start request message parameters\n    headers = {\n        \'Authorization\': \'Bearer \' + token,\n        \'cache-control\': \'no-cache\',\n    }\n\n    params = (\n    (\'start\', since),\n    (\'end\', until),\n    (\'limit\', \'200\'),\n    )\n\n    for sname in services:\n\n        # create event bucket and message var    \n        events = []\n        message = ""\n\n        # create the iterable URL and pass it to the API request\n        url_maker = "https://api.tmcas.trendmicro.com/siem/v1/security_events?service=" + sname + "&event=securityrisk"\n        print(url_maker)\n        response = requests.get(url_maker, headers=headers, params=params)\n\n        # work the deserialized response\n        current_incidents = json.loads(response.text)\n        print(current_incidents)\n\n        # iterate in the response and format the log line message\n        print(current_incidents["next_link"])\n        if (len(current_incidents["security_events"]) > 0):\n            if (current_incidents["next_link"] != \'\'):\n                nxtlink = 1\n                url_maker_nxtlink.insert(-1,current_incidents["next_link"])\n\n            print(len(current_incidents["security_events"]))\n            for index in range(len(current_incidents["security_events"])):\n                for key in current_incidents["security_events"][index]:\n                    if key == "event":\n                        event_name = current_incidents["security_events"][index][key]\n                    elif key == "message":\n                        detection_time = current_incidents["security_events"][index][key]["detection_time"]\n                        mail_message_recipient = current_incidents["security_events"][index][key]["mail_message_recipient"]\n                        scan_type = current_incidents["security_events"][index][key]["scan_type"]\n                        affected_user = current_incidents["security_events"][index][key]["affected_user"]\n                        location = current_incidents["security_events"][index][key]["location"]\n                        triggered_policy_name = current_incidents["security_events"][index][key]["triggered_policy_name"]\n                        triggered_security_filter = current_incidents["security_events"][index][key]["triggered_security_filter"]\n                        action = current_incidents["security_events"][index][key]["action"]\n                        action_result = current_incidents["security_events"][index][key]["action_result"]\n                        mail_message_id = current_incidents["security_events"][index][key]["mail_message_id"]\n                        mail_message_sender = current_incidents["security_events"][index][key]["mail_message_sender"]\n                        mail_message_submit_time = current_incidents["security_events"][index][key]["mail_message_submit_time"]\n                        mail_message_delivery_time = current_incidents["security_events"][index][key]["mail_message_delivery_time"]\n                        mail_message_subject = current_incidents["security_events"][index][key]["mail_message_subject"]\n                        mail_message_file_name = current_incidents["security_events"][index][key]["mail_message_file_name"]\n                        security_risk_name = current_incidents["security_events"][index][key]["security_risk_name"]\n                        detected_by = current_incidents["security_events"][index][key]["detected_by"]\n                        risk_level = current_incidents["security_events"][index][key]["risk_level"]\n\n                    # log message creation\n\n                        # convert ISO8601 time format to unix timestamp\n\n                        dp_detectetime = dp.parse(detection_time)\n                        ut_detectedtime = int(time.mktime(dp_detectetime.timetuple()))\n                        ut_detectedtime = str(ut_detectedtime)\n\n                        dp_mail_submittime = dp.parse(mail_message_submit_time)\n                        ut_mail_submittime = int(time.mktime(dp_mail_submittime.timetuple()))\n                        ut_mail_submittime = str(ut_mail_submittime)\n                        \n                        dp_mail_deliverytime = dp.parse(mail_message_delivery_time)\n                        ut_mail_deliverytime = int(time.mktime(dp_mail_deliverytime.timetuple()))\n                        ut_mail_deliverytime = str(ut_mail_deliverytime)\n\n                        # extract mail_message_recipient\'s emails\n                        if len(mail_message_recipient) > 1:\n                            str_mail_message_recipient = \' \'.join([str(item) for item in mail_message_recipient])\n                            str_mail_message_recipient = str_mail_message_recipient.replace(\'\\"\', \'\')\n                            recipients_mail = re.findall(r\'[a-z0-9.\\-+_]+@[a-z0-9.\\-+_]+\\.[a-z]+\', str_mail_message_recipient)\n                            str_mail_message_recipient = \' \'.join([str(item) for item in recipients_mail])\n                            str_mail_message_recipient = str_mail_message_recipient.replace(\' \', \';\')\n                        elif len(mail_message_recipient) == 1:\n                            str_mail_message_recipient = \' \'.join([str(item) for item in mail_message_recipient])\n                        \n                        str_mail_message_file_name = mail_message_file_name.replace(\',\', \';\')\n                        str_mail_message_subject = mail_message_subject.replace(\',\', \';\')\n                        str_mail_message_sender = mail_message_sender.replace(\'\\"\', \'\')\n\n                        # main message creation\n                        message = str(now_log_time) + " tmcas.customername.com, application=\\"tmcas-" + sname + "-"+ event_name + "\\", detectedutc=\\"" + ut_detectedtime + "\\", scan_type=\\"" + scan_type + "\\", affected_user=\\"" + affected_user + "\\", location=\\"" + location + "\\", triggered_policy_name=\\"" + triggered_policy_name + "\\", triggered_security_filter=\\"" + triggered_security_filter + "\\", action=\\"" + action + "\\", action_result=\\"" + action_result + "\\", mail_message_id=\\"" + mail_message_id + "\\", mail_message_sender=\\"" + str_mail_message_sender + "\\", mail_message_recipient=\\"" + str_mail_message_recipient + "\\", mail_message_submit_time=\\"" + ut_mail_submittime + "\\", mail_message_delivery_time=\\"" + ut_mail_deliverytime + "\\", mail_message_subject=\\"" + str_mail_message_subject + "\\", mail_message_file_name=\\"" + str_mail_message_file_name +  "\\", security_risk_name=\\"" + security_risk_name + "\\", detected_by=\\"" + detected_by + "\\", risk_level=\\"" + risk_level + "\\""\n\n                        events.insert(-1, message)\n\n    # write events to the log file \n\n        for i in range(len(events)):\n            with open(filepath, "a+") as file_log:\n                file_log.seek(0)\n                data = file_log.read(100)\n                if len(data) > 0 :\n                    file_log.write("\\n")\n                file_log.write(events[i])\n        print(len(events))\n\n    # check if there are a new page of events for being processed, then do it!\n    if (nxtlink == 1):\n        for url in url_maker_nxtlink:\n\n            # restate event bucket and message var    \n            events = []\n            message = ""\n            \n            print(url)\n            print(len(url_maker_nxtlink))\n            response = requests.get(url, headers=headers, params=params)\n\n            # work the deserialized response\n            current_incidents = json.loads(response.text)\n\n            # iterate in the response and format the log line message\n            if (len(current_incidents["security_events"]) > 0):\n\n                if (current_incidents["next_link"] != \'\'):\n                    url_maker_nxtlink.insert(-1, current_incidents["next_link"])\n\n                print(len(current_incidents["security_events"]))\n                for index in range(len(current_incidents["security_events"])):\n                    for key in current_incidents["security_events"][index]:\n                        if key == "event":\n                            event_name = current_incidents["security_events"][index][key]\n                        elif key == "message":\n                            detection_time = current_incidents["security_events"][index][key]["detection_time"]\n                            mail_message_recipient = current_incidents["security_events"][index][key]["mail_message_recipient"]\n                            scan_type = current_incidents["security_events"][index][key]["scan_type"]\n                            affected_user = current_incidents["security_events"][index][key]["affected_user"]\n                            location = current_incidents["security_events"][index][key]["location"]\n                            triggered_policy_name = current_incidents["security_events"][index][key]["triggered_policy_name"]\n                            triggered_security_filter = current_incidents["security_events"][index][key]["triggered_security_filter"]\n                            action = current_incidents["security_events"][index][key]["action"]\n                            action_result = current_incidents["security_events"][index][key]["action_result"]\n                            mail_message_id = current_incidents["security_events"][index][key]["mail_message_id"]\n                            mail_message_sender = current_incidents["security_events"][index][key]["mail_message_sender"]\n                            mail_message_submit_time = current_incidents["security_events"][index][key]["mail_message_submit_time"]\n                            mail_message_delivery_time = current_incidents["security_events"][index][key]["mail_message_delivery_time"]\n                            mail_message_subject = current_incidents["security_events"][index][key]["mail_message_subject"]\n                            mail_message_file_name = current_incidents["security_events"][index][key]["mail_message_file_name"]\n                            risk_level = current_incidents["security_events"][index][key]["risk_level"]\n                            security_risk_name = current_incidents["security_events"][index][key]["security_risk_name"]\n                            detected_by = current_incidents["security_events"][index][key]["detected_by"]\n                            risk_level = current_incidents["security_events"][index][key]["risk_level"]\n\n                        # log message creation\n\n                            # convert ISO8601 time format to unix timestamp\n\n                            dp_detectetime = dp.parse(detection_time)\n                            ut_detectedtime = int(time.mktime(dp_detectetime.timetuple()))\n                            ut_detectedtime = str(ut_detectedtime)\n\n                            dp_mail_submittime = dp.parse(mail_message_submit_time)\n                            ut_mail_submittime = int(time.mktime(dp_mail_submittime.timetuple()))\n                            ut_mail_submittime = str(ut_mail_submittime)\n                            \n                            dp_mail_deliverytime = dp.parse(mail_message_delivery_time)\n                            ut_mail_deliverytime = int(time.mktime(dp_mail_deliverytime.timetuple()))\n                            ut_mail_deliverytime = str(ut_mail_deliverytime)\n\n                            # extract mail_message_recipient\'s emails\n                            if len(mail_message_recipient) > 1:\n                                str_mail_message_recipient = \' \'.join([str(item) for item in mail_message_recipient])\n                                str_mail_message_recipient = str_mail_message_recipient.replace(\'\\"\', \'\')\n                                recipients_mail = re.findall(r\'[a-z0-9.\\-+_]+@[a-z0-9.\\-+_]+\\.[a-z]+\', str_mail_message_recipient)\n                                str_mail_message_recipient = \' \'.join([str(item) for item in recipients_mail])\n                                str_mail_message_recipient = str_mail_message_recipient.replace(\' \', \';\')\n                            elif len(mail_message_recipient) == 1:\n                                str_mail_message_recipient = \' \'.join([str(item) for item in mail_message_recipient])\n\n                            # clean up dangerous characters\n                            str_mail_message_file_name = mail_message_file_name.replace(\',\', \';\')\n                            str_mail_message_subject = mail_message_subject.replace(\',\', \';\')\n                            str_mail_message_sender = mail_message_sender.replace(\'\\"\', \'\')\n\n                            # main message creation\n                            message = str(now_log_time) + " tmcas.customername.com, application=\\"tmcas-" + sname + "-"+ event_name + "\\", detectedutc=\\"" + ut_detectedtime + "\\", scan_type=\\"" + scan_type + "\\", affected_user=\\"" + affected_user + "\\", location=\\"" + location + "\\", triggered_policy_name=\\"" + triggered_policy_name + "\\", triggered_security_filter=\\"" + triggered_security_filter + "\\", action=\\"" + action + "\\", action_result=\\"" + action_result + "\\", mail_message_id=\\"" + mail_message_id + "\\", mail_message_sender=\\"" + str_mail_message_sender + "\\", mail_message_recipient=\\"" + str_mail_message_recipient + "\\", mail_message_submit_time=\\"" + ut_mail_submittime + "\\", mail_message_delivery_time=\\"" + ut_mail_deliverytime + "\\", mail_message_subject=\\"" + str_mail_message_subject + "\\", mail_message_file_name=\\"" + str_mail_message_file_name +  "\\", security_risk_name=\\"" + security_risk_name + "\\", detected_by=\\"" + detected_by + "\\", risk_level=\\"" + risk_level + "\\""\n\n                            events.insert(-1, message)\n\n            # write events to the log file \n            for i in range(len(events)):\n                with open(filepath, "a+") as file_log:\n                \n                    file_log.seek(0)\n                    data = file_log.read(100)\n                    if len(data) > 0 :\n                        file_log.write("\\n")\n                    file_log.write(events[i])\n            print(len(events))\n\nif __name__ == "__main__":\n    while True:\n        doit()\n        time.sleep(300)\n'})}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",metastring:'title="/opt/tmcas/virtualanalyzer-event-parser.py"',children:'###########################################################\n####                                                   ####\n#### Trend Micro Cloud App - Virtual Analyzer events   ####\n####                                                   ####\n####                                           ver.1.0 ####\n###########################################################\n\nimport requests, json, datetime, time, os.path, re\nimport dateutil.parser as dp\nfrom datetime import timedelta\n\n# path for testing\n\npath_dir = "/var/netwitness/logcollector/upload/trendcloudapp/trendcloudapp/"\nfilepath = os.path.join(path_dir, "virtualanalyzer-events.log")\n\n\n# define services to be processed\nservices = ["exchange","teams","sharepoint","onedrive"]\n\n\ndef doit():\n\n    # open token file:\n    with open("token.json", "r") as read_file:\n        data_json = json.load(read_file)\n    token = data_json["access"]\n\n\n    # create \'next page link\' signaler\n    nxtlink = 0\n    url_maker_nxtlink = []\n\n\n    # format time interval and define the \'start\' and \'end\' ranges\n    now_log_time = datetime.datetime.now().replace(microsecond=0).isoformat(\' \')\n    now_time = datetime.datetime.now().replace(microsecond=0).isoformat()\n    previous_time = datetime.datetime.now() - timedelta(hours=1, minutes=0)\n    since = previous_time.strftime("%Y-%m-%dT%H:%M:%S.000%z") + \'Z\'\n    until = now_time + \'.000Z\'\n\n    # Start request message parameters\n    headers = {\n        \'Authorization\': \'Bearer \' + token,\n        \'cache-control\': \'no-cache\',\n    }\n\n    params = (\n    (\'start\', since),\n    (\'end\', until),\n    (\'limit\', \'200\'),\n    )\n\n    for sname in services:\n        \n        # create event bucket and message var    \n        events = []\n        message = ""\n\n        # create the iterable URL and pass it to the API request\n        url_maker = "https://api.tmcas.trendmicro.com/siem/v1/security_events?service=" + sname + "&event=virtualanalyzer"\n        print(url_maker)\n        response = requests.get(url_maker, headers=headers, params=params)\n\n        # work the deserialized response\n        current_incidents = json.loads(response.text)\n\n        # iterate in the response and format the log line message\n        if (len(current_incidents["security_events"]) > 0):\n            if (current_incidents["next_link"] != \'\'):\n                nxtlink = 1\n                url_maker_nxtlink.insert(-1, current_incidents["next_link"])\n\n            print(len(current_incidents["security_events"]))\n            for index in range(len(current_incidents["security_events"])):\n                for key in current_incidents["security_events"][index]:\n                    if key == "event":\n                        event_name = current_incidents["security_events"][index][key]\n                    elif key == "message":\n                        detection_time = current_incidents["security_events"][index][key]["detection_time"]\n                        mail_message_recipient = current_incidents["security_events"][index][key]["mail_message_recipient"]\n                        scan_type = current_incidents["security_events"][index][key]["scan_type"]\n                        affected_user = current_incidents["security_events"][index][key]["affected_user"]\n                        location = current_incidents["security_events"][index][key]["location"]\n                        triggered_policy_name = current_incidents["security_events"][index][key]["triggered_policy_name"]\n                        triggered_security_filter = current_incidents["security_events"][index][key]["triggered_security_filter"]\n                        action = current_incidents["security_events"][index][key]["action"]\n                        action_result = current_incidents["security_events"][index][key]["action_result"]\n                        mail_message_id = current_incidents["security_events"][index][key]["mail_message_id"]\n                        mail_message_sender = current_incidents["security_events"][index][key]["mail_message_sender"]\n                        mail_message_submit_time = current_incidents["security_events"][index][key]["mail_message_submit_time"]\n                        mail_message_delivery_time = current_incidents["security_events"][index][key]["mail_message_delivery_time"]\n                        mail_message_subject = current_incidents["security_events"][index][key]["mail_message_subject"]\n                        mail_message_file_name = current_incidents["security_events"][index][key]["mail_message_file_name"]\n                        risk_level = current_incidents["security_events"][index][key]["risk_level"]\n                        detection_type = current_incidents["security_events"][index][key]["detection_type"]\n                        file_sha1 = current_incidents["security_events"][index][key]["file_sha1"]\n                        file_sha256 = current_incidents["security_events"][index][key]["file_sha256"]\n\n                    # log message creation\n\n                        # convert ISO8601 time format to unix timestamp\n\n                        dp_detectetime = dp.parse(detection_time)\n                        ut_detectedtime = int(time.mktime(dp_detectetime.timetuple()))\n                        ut_detectedtime = str(ut_detectedtime)\n\n                        dp_mail_submittime = dp.parse(mail_message_submit_time)\n                        ut_mail_submittime = int(time.mktime(dp_mail_submittime.timetuple()))\n                        ut_mail_submittime = str(ut_mail_submittime)\n                        \n                        dp_mail_deliverytime = dp.parse(mail_message_delivery_time)\n                        ut_mail_deliverytime = int(time.mktime(dp_mail_deliverytime.timetuple()))\n                        ut_mail_deliverytime = str(ut_mail_deliverytime)\n\n\n                        # extract mail_message_recipient\'s emails\n                        if len(mail_message_recipient) > 1:\n                            str_mail_message_recipient = \' \'.join([str(item) for item in mail_message_recipient])\n                            str_mail_message_recipient = str_mail_message_recipient.replace(\'\\"\', \'\')\n                            recipients_mail = re.findall(r\'[a-z0-9.\\-+_]+@[a-z0-9.\\-+_]+\\.[a-z]+\', str_mail_message_recipient)\n                            str_mail_message_recipient = \' \'.join([str(item) for item in recipients_mail])\n                            str_mail_message_recipient = str_mail_message_recipient.replace(\' \', \';\')\n                        elif len(mail_message_recipient) == 1:\n                            str_mail_message_recipient = \' \'.join([str(item) for item in mail_message_recipient])\n                        \n                        # clean up dangerous characters\n                        str_mail_message_file_name = mail_message_file_name.replace(\',\', \';\')\n                        str_mail_message_subject = mail_message_subject.replace(\',\', \';\')\n                        str_mail_message_sender = mail_message_sender.replace(\'\\"\', \'\')\n\n                        # main message creation\n                        message = str(now_log_time) + " tmcas.customername.com, application=\\"tmcas-" + sname + "-"+ event_name + "\\", detectedutc=\\"" + ut_detectedtime + "\\", scan_type=\\"" + scan_type + "\\", affected_user=\\"" + affected_user + "\\", location=\\"" + location + "\\", triggered_policy_name=\\"" + triggered_policy_name + "\\", triggered_security_filter=\\"" + triggered_security_filter + "\\", action=\\"" + action + "\\", action_result=\\"" + action_result + "\\", mail_message_id=\\"" + mail_message_id + "\\", mail_message_sender=\\"" + str_mail_message_sender + "\\", mail_message_recipient=\\"" + str_mail_message_recipient + "\\", mail_message_submit_time=\\"" + ut_mail_submittime + "\\", mail_message_delivery_time=\\"" + ut_mail_deliverytime + "\\", mail_message_subject=\\"" + str_mail_message_subject + "\\", mail_message_file_name=\\"" + str_mail_message_file_name + "\\", risk_level=\\"" + risk_level + "\\", detection_type=\\"" + detection_type + "\\", file_sha1=\\"" + file_sha1 + "\\", file_sha256=\\"" + file_sha256 + "\\""\n\n                        events.insert(-1, message)\n\n    # write events to the log file \n\n        for i in range(len(events)):\n            with open(filepath, "a+") as file_log:\n                file_log.seek(0)\n                data = file_log.read(100)\n                if len(data) > 0 :\n                    file_log.write("\\n")\n                file_log.write(events[i])\n        print(len(events))\n\n    # check if there are a new page of events for being processed, then do it!\n    if (nxtlink == 1):\n\n        for url in url_maker_nxtlink:\n\n            # restate event bucket and message var    \n            events = []\n            message = ""\n            \n            print(url)\n            print(len(url_maker_nxtlink))\n            response = requests.get(url, headers=headers, params=params)\n\n            # work the deserialized response\n            current_incidents = json.loads(response.text)\n\n            # iterate in the response and format the log line message\n            if (len(current_incidents["security_events"]) > 0):\n                \n                if (current_incidents["next_link"] != \'\'):\n                    url_maker_nxtlink.insert(-1, current_incidents["next_link"])\n\n                print(len(current_incidents["security_events"]))\n                for index in range(len(current_incidents["security_events"])):\n                    for key in current_incidents["security_events"][index]:\n                        if key == "event":\n                            event_name = current_incidents["security_events"][index][key]\n                        elif key == "message":\n                            detection_time = current_incidents["security_events"][index][key]["detection_time"]\n                            mail_message_recipient = current_incidents["security_events"][index][key]["mail_message_recipient"]\n                            scan_type = current_incidents["security_events"][index][key]["scan_type"]\n                            affected_user = current_incidents["security_events"][index][key]["affected_user"]\n                            location = current_incidents["security_events"][index][key]["location"]\n                            triggered_policy_name = current_incidents["security_events"][index][key]["triggered_policy_name"]\n                            triggered_security_filter = current_incidents["security_events"][index][key]["triggered_security_filter"]\n                            action = current_incidents["security_events"][index][key]["action"]\n                            action_result = current_incidents["security_events"][index][key]["action_result"]\n                            mail_message_id = current_incidents["security_events"][index][key]["mail_message_id"]\n                            mail_message_sender = current_incidents["security_events"][index][key]["mail_message_sender"]\n                            mail_message_submit_time = current_incidents["security_events"][index][key]["mail_message_submit_time"]\n                            mail_message_delivery_time = current_incidents["security_events"][index][key]["mail_message_delivery_time"]\n                            mail_message_subject = current_incidents["security_events"][index][key]["mail_message_subject"]\n                            mail_message_file_name = current_incidents["security_events"][index][key]["mail_message_file_name"]\n                            risk_level = current_incidents["security_events"][index][key]["risk_level"]\n                            detection_type = current_incidents["security_events"][index][key]["detection_type"]\n                            file_sha1 = current_incidents["security_events"][index][key]["file_sha1"]\n                            file_sha256 = current_incidents["security_events"][index][key]["file_sha256"]\n\n                        # log message creation\n\n                            # convert ISO8601 time format to unix timestamp\n\n                            dp_detectetime = dp.parse(detection_time)\n                            ut_detectedtime = int(time.mktime(dp_detectetime.timetuple()))\n                            ut_detectedtime = str(ut_detectedtime)\n\n                            dp_mail_submittime = dp.parse(mail_message_submit_time)\n                            ut_mail_submittime = int(time.mktime(dp_mail_submittime.timetuple()))\n                            ut_mail_submittime = str(ut_mail_submittime)\n                            \n                            dp_mail_deliverytime = dp.parse(mail_message_delivery_time)\n                            ut_mail_deliverytime = int(time.mktime(dp_mail_deliverytime.timetuple()))\n                            ut_mail_deliverytime = str(ut_mail_deliverytime)\n\n                            # extract mail_message_recipient\'s emails\n                            if len(mail_message_recipient) > 1:\n                                str_mail_message_recipient = \' \'.join([str(item) for item in mail_message_recipient])\n                                str_mail_message_recipient = str_mail_message_recipient.replace(\'\\"\', \'\')\n                                recipients_mail = re.findall(r\'[a-z0-9.\\-+_]+@[a-z0-9.\\-+_]+\\.[a-z]+\', str_mail_message_recipient)\n                                str_mail_message_recipient = \' \'.join([str(item) for item in recipients_mail])\n                                str_mail_message_recipient = str_mail_message_recipient.replace(\' \', \';\')\n                            elif len(mail_message_recipient) == 1:\n                                str_mail_message_recipient = \' \'.join([str(item) for item in mail_message_recipient])\n                            \n                            str_mail_message_file_name = mail_message_file_name.replace(\',\', \';\')\n                            str_mail_message_subject = mail_message_subject.replace(\',\', \';\')\n                            str_mail_message_sender = mail_message_sender.replace(\'\\"\', \'\')\n\n                            # main message creation\n                            message = str(now_log_time) + " tmcas.customername.com, application=\\"tmcas-" + sname + "-"+ event_name + "\\", detectedutc=\\"" + ut_detectedtime + "\\", scan_type=\\"" + scan_type + "\\", affected_user=\\"" + affected_user + "\\", location=\\"" + location + "\\", triggered_policy_name=\\"" + triggered_policy_name + "\\", triggered_security_filter=\\"" + triggered_security_filter + "\\", action=\\"" + action + "\\", action_result=\\"" + action_result + "\\", mail_message_id=\\"" + mail_message_id + "\\", mail_message_sender=\\"" + str_mail_message_sender + "\\", mail_message_recipient=\\"" + str_mail_message_recipient + "\\", mail_message_submit_time=\\"" + ut_mail_submittime + "\\", mail_message_delivery_time=\\"" + ut_mail_deliverytime + "\\", mail_message_subject=\\"" + str_mail_message_subject + "\\", mail_message_file_name=\\"" + str_mail_message_file_name + "\\", risk_level=\\"" + risk_level + "\\", detection_type=\\"" + detection_type + "\\", file_sha1=\\"" + file_sha1 + "\\", file_sha256=\\"" + file_sha256 + "\\""\n\n                            events.insert(-1, message)\n\n        # write events to the log file \n            for i in range(len(events)):\n                with open(filepath, "a+") as file_log:\n                \n                    file_log.seek(0)\n                    data = file_log.read(100)\n                    if len(data) > 0 :\n                        file_log.write("\\n")\n                    file_log.write(events[i])\n            print(len(events))\n\n\nif __name__ == "__main__":\n    while True:\n        doit()\n        time.sleep(300)\n'})}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",metastring:'title="/opt/tmcas/token.json"',children:'{"token_type":"Bearer","expires_in":"unknown","access":"MYBEARERTOKEN"}\n'})})]}),"\n",(0,i.jsxs)(r,{children:[(0,i.jsx)("summary",{children:"Example parser for XDR using Python and a credential token for authentication with the API and the eventsource type specification."}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-xml",metastring:'title="/etc/netwitness/ng/logcollection/content/collection/file/trendmicroxdr.xml"',children:'<?xml version="1.0" encoding="UTF-8"?>\n<typespec>\n\n   <name>trendmicroxdr</name>\n   <type>file</type>\n   <prettyName>Trend Micro XDR</prettyName>\n   <version>1.0</version>\n   <author>administrator</author>\n   <description>FileCollection specification for eventsource type "Trend Micro XDR Solution"</description>\n\n\t<device>\n\t\t<name>trendmicroxdr</name>\n\t</device>\n\t\n\t<configuration>\n\t</configuration>\n\n\t<collection>\n\t        <file>\n                <parserId>trendmicroxdr</parserId>\n                <processorType>generic</processorType>\n                <dataStartLine>1</dataStartLine>\n\t\t        <fieldDelim>,</fieldDelim>\n\t\t        <idField></idField>\n\t\t        <lineDelim>\\n</lineDelim>\n\t\t        <transformPrefixTag>trendmicroxdr</transformPrefixTag>\n\t\t        <transformReplaceFieldDelim>0</transformReplaceFieldDelim>\n\t\t        <transformPrefixFilename>0</transformPrefixFilename>\n\t\t        <transformMultipleDelimiterAsOne>0</transformMultipleDelimiterAsOne>\n\t\t        <transformReplacementFieldDelim></transformReplacementFieldDelim>\n\t        </file>\n\t</collection>\n</typespec>\n'})}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",metastring:'title="/opt/tmxdr/tmxdr-attack-techniques.py"',children:'import requests, json, datetime, time, os.path, re\nimport dateutil.parser as dp\nfrom datetime import timedelta\n\n# Base URL for the requested resources\n\nurl_base = \'https://api.xdr.trendmicro.com\'\nurl_path = \'/v2.0/xdr/oat/detections\'\n\n# Path to save logs to\npath_dir = "/var/netwitness/logcollector/upload/trendmicroxdr/trendmicroxdr/"\nfilepath = os.path.join(path_dir, "attack-techniques-events.log")\n\n\ndef doit():\n\n    # open token file:\n    with open("/opt/tmxdr/token.json", "r") as read_file:\n        data_json = json.load(read_file)\n    token = data_json["access"]\n\n    # create \'next page link\' signaler\n    nxtlink = 0\n    token_nxtlink = ""\n\n    ################### ADJUST TIME PARAMETERS #######################\n    ## format time interval and define the \'start\' and \'end\' ranges ##\n    ##################################################################\n\n    now_log_time = datetime.datetime.now().replace(microsecond=0).isoformat(\' \')\n    now_time = datetime.datetime.now().replace(microsecond=0).isoformat()\n    previous_time = datetime.datetime.now() - timedelta(hours=0, minutes=5)\n\n    since = previous_time.strftime("%Y-%m-%dT%H:%M:%S.000%z") + \'Z\'\n    until = now_time\n\n    # convert \'since\' to timestamp format\n    dp_since = dp.parse(since)\n    ut_since = int(time.mktime(dp_since.timetuple()))\n    ut_since = str(ut_since)\n\n    # convert \'until\' to timestamp format\n    dp_until = dp.parse(until)\n    ut_until = int(time.mktime(dp_until.timetuple()))\n    ut_until = str(ut_until)\n\n    # Start request message parameters\n    headers = {\'Authorization\': \'Bearer \' + token, \'Content-Type\': \'application/json;charset=utf-8\'}\n\n\n    params = (\n    (\'start\', ut_since),\n    (\'end\', ut_until),\n    (\'size\', \'10\')\n    )\n\n    # create event bucket and message var    \n    events = []\n    message = ""\n\n    # request event alerts\n    response = requests.get(url_base + url_path, headers=headers, params=params)\n    print(response.url)\n\n    # work the deserialized response\n    current_incidents = json.loads(response.text)\n    response = ""\n\n    # iterate in the response and format the log line message\n    if len(current_incidents["data"]["detections"]) > 0:\n\n        hasToken = current_incidents["data"].get("nextBatchToken")\n        if hasToken == None:\n            nxtlink = 0\n            print("Events finished")\n\n        else:\n            nxtlink = 1\n            token_nxtlink = current_incidents["data"]["nextBatchToken"]\n\n        events = []\n        message = ""\n\n        for index in range(len(current_incidents["data"]["detections"])):\n            for key in current_incidents["data"]["detections"][index]:\n                if key == "source":\n                    det_source = current_incidents["data"]["detections"][index][key]\n                elif key == "detectionTime":\n                    detection_time = current_incidents["data"]["detections"][index][key]\n                elif key == "uuid":\n                    uuid = current_incidents["data"]["detections"][index][key]\n                elif key == "endpoint":\n                    endpoint_name = current_incidents["data"]["detections"][index][key]["name"]\n                    endpoint_guid = current_incidents["data"]["detections"][index][key]["guid"]\n                    if len(current_incidents["data"]["detections"][index][key]["ips"]) > 1:\n                        endpoint_ip = \';\'.join([str(item) for item in current_incidents["data"]["detections"][index][key]["ips"]])\n                    else:\n                        endpoint_ip = \' \'.join([str(item) for item in current_incidents["data"]["detections"][index][key]["ips"]])\n\n                elif key == "filters":\n                    for filter in range(len(current_incidents["data"]["detections"][index]["filters"])):\n                        for k in current_incidents["data"]["detections"][index]["filters"][filter]:\n                            \n                            if k == "id":\n                                filter_id = current_incidents["data"]["detections"][index]["filters"][filter][k]\n                            elif k == "unique_id":\n                                filter_uid = current_incidents["data"]["detections"][index]["filters"][filter][k]\n                            elif k == "level":\n                                filter_level = current_incidents["data"]["detections"][index]["filters"][filter][k]\n                            elif k == "name":\n                                filter_name = current_incidents["data"]["detections"][index]["filters"][filter][k]\n                            elif k == "description":\n                                filter_description = current_incidents["data"]["detections"][index]["filters"][filter][k]\n                            elif k == "tactics":\n                                \n                                if len(current_incidents["data"]["detections"][index]["filters"][filter]["tactics"]) > 1:\n                                    tactics = \' \'.join([str(item) for item in current_incidents["data"]["detections"][index]["filters"][filter]["tactics"]])\n                                    tactics = tactics.replace(\' \', \';\')\n                                else:\n                                    tactics = \' \'.join([str(item) for item in current_incidents["data"]["detections"][index]["filters"][filter]["tactics"]])\n                            \n                            elif k == "techniques":\n                            \n                                if len(current_incidents["data"]["detections"][index]["filters"][filter]["techniques"]) > 1:\n                                    techniques = \';\'.join([str(item) for item in current_incidents["data"]["detections"][index]["filters"][filter]["techniques"]])\n                                else:\n                                    techniques = \' \'.join([str(item) for item in current_incidents["data"]["detections"][index]["filters"][filter]["techniques"]])\n                            \n                            elif k == "highlightedObjects":\n                                \n                                if len(current_incidents["data"]["detections"][index]["filters"][filter]["highlightedObjects"]) > 1:\n                                    fld1 = []\n                                    value1 = []\n                                    highlights = []\n\n                                    for object in range(len(current_incidents["data"]["detections"][index]["filters"][filter]["highlightedObjects"])):\n                                        \n                                        for kye in current_incidents["data"]["detections"][index]["filters"][filter]["highlightedObjects"][object]:\n                                            if kye == "field":\n                                                fieldName = current_incidents["data"]["detections"][index]["filters"][filter]["highlightedObjects"][object][kye]\n                                                fld1.insert(1, fieldName)\n                                            elif kye == "value":\n                                                valueName = current_incidents["data"]["detections"][index]["filters"][filter]["highlightedObjects"][object][kye]\n                                                isArray = isinstance(valueName, list)\n                                                if (isArray == True):\n                                                    valueName = \';\'.join([str(item) for item in valueName])\n                                                    valueName = valueName.replace(\'{\', \'\\{\')\n                                                    valueName = valueName.replace(\'}\', \'\\}\')\n                                                    valueName = valueName.replace(\'\\"\', \'\\\\\\\'\')\n                                                else:\n                                                    valueName = str(valueName)\n                                                    valueName = valueName.replace(\'{\', \'\\{\')\n                                                    valueName = valueName.replace(\'}\', \'\\}\')\n                                                    valueName = valueName.replace(\'\\"\', \'\\\\\\\'\')\n                                                value1.insert(1, valueName)\n\n                                    for flditems in range(len(fld1)):\n                                        highlighted = fld1[flditems] +"=\\"" + value1[flditems] + "\\""\n                                        highlights.insert(1, highlighted)\n\n                                    highlightedObj = \', \'.join([str(item) for item in highlights])\n                                    \n                                else:\n                                    fld1 = current_incidents["data"]["detections"][index]["filters"][filter]["highlightedObjects"][0]["field"]\n                                    value1 = current_incidents["data"]["detections"][index]["filters"][filter]["highlightedObjects"][0]["value"]\n                                    value1 = value1.replace(\'{\', \'\\{\')\n                                    value1 = value1.replace(\'}\', \'\\}\')\n                                    value1 = value1.replace(\'\\"\', \'\\\\\\\'\')\n                                    highlightedObj = fld1 + "=\\"" + value1 + "\\""\n\n            # convert ISO8601 time format to unix timestamp\n\n            dp_detectetime = dp.parse(detection_time)\n            ut_detectedtime = int(time.mktime(dp_detectetime.timetuple()))\n            ut_detectedtime = str(ut_detectedtime)\n\n            message = str(now_log_time) + " tmxdr.customername.com, application=\\"trendmicroxdr-" + det_source + "\\", detectedutc=\\"" + ut_detectedtime + "\\", uuid=\\"" + uuid + "\\", endpoint=\\"" + endpoint_name + "\\", endpoint_guid=\\"" + endpoint_guid + "\\", endpoint_ip=\\"" + endpoint_ip + "\\", filter_id=\\"" + filter_id + "\\", filter_uid=\\"" + filter_uid + "\\", filter_level=\\"" + filter_level + "\\", filter_name=\\"" + filter_name + "\\", filter_description=\\"" + filter_description +"\\", tactics=\\"" + tactics + "\\", techniques=\\"" + techniques + "\\", " + highlightedObj\n\n            events.insert(-1, message)\n    current_incidents = {}\n\n    # write events to the log file \n    for i in range(len(events)):\n        with open(filepath, "a+") as file_log:\n            file_log.seek(0)\n            data = file_log.read(100)\n            if len(data) > 0 :\n                file_log.write("\\n")\n            file_log.write(events[i])\n    print(len(events))\n\n    # check if there are a new page of events for being processed, then do it!\n    while (nxtlink == 1):\n\n        # restate event bucket and message var    \n        events = []\n        message = ""\n\n        params = (\n            (\'start\', ut_since),\n            (\'end\', ut_until),\n            (\'size\', \'10\'),\n            (\'nextBatchToken\', token_nxtlink),\n        )\n\n        headers = {\'Authorization\': \'Bearer \' + token, \'Content-Type\': \'application/json;charset=utf-8\'}\n        \n        # request event alerts\n        response = requests.get(url_base + url_path, headers=headers, params=params)\n        \n        # work the deserialized response\n        current_incidents = json.loads(response.text)\n        response = ""\n\n        # iterate in the response and format the log line message\n        if len(current_incidents["data"]["detections"]) > 0:\n\n            hasToken = current_incidents["data"].get("nextBatchToken")\n            if (hasToken == None):\n                nxtlink = 0\n                token_nxtlink = ""\n                print("Events finished")\n            else:\n                nxtlink = 1\n                token_nxtlink = current_incidents["data"]["nextBatchToken"]\n\n            for index in range(len(current_incidents["data"]["detections"])):\n                for key in current_incidents["data"]["detections"][index]:\n                    if key == "source":\n                        det_source = current_incidents["data"]["detections"][index][key]\n                    elif key == "detectionTime":\n                        detection_time = current_incidents["data"]["detections"][index][key]\n                    elif key == "uuid":\n                        uuid = current_incidents["data"]["detections"][index][key]\n                    elif key == "endpoint":\n                        endpoint_name = current_incidents["data"]["detections"][index][key]["name"]\n                        endpoint_guid = current_incidents["data"]["detections"][index][key]["guid"]\n                        if len(current_incidents["data"]["detections"][index][key]["ips"]) > 1:\n                            endpoint_ip = \';\'.join([str(item) for item in current_incidents["data"]["detections"][index][key]["ips"]])\n                        else:\n                            endpoint_ip = \' \'.join([str(item) for item in current_incidents["data"]["detections"][index][key]["ips"]])\n\n                    elif key == "filters":\n                        for filter in range(len(current_incidents["data"]["detections"][index]["filters"])):\n                            for k in current_incidents["data"]["detections"][index]["filters"][filter]:\n                                \n                                if k == "id":\n                                    filter_id = current_incidents["data"]["detections"][index]["filters"][filter][k]\n                                elif k == "unique_id":\n                                    filter_uid = current_incidents["data"]["detections"][index]["filters"][filter][k]\n                                elif k == "level":\n                                    filter_level = current_incidents["data"]["detections"][index]["filters"][filter][k]\n                                elif k == "name":\n                                    filter_name = current_incidents["data"]["detections"][index]["filters"][filter][k]\n                                elif k == "description":\n                                    filter_description = current_incidents["data"]["detections"][index]["filters"][filter][k]\n                                elif k == "tactics":\n                                    \n                                    if len(current_incidents["data"]["detections"][index]["filters"][filter]["tactics"]) > 1:\n                                        tactics = \' \'.join([str(item) for item in current_incidents["data"]["detections"][index]["filters"][filter]["tactics"]])\n                                        tactics = tactics.replace(\' \', \';\')\n                                    else:\n                                        tactics = \' \'.join([str(item) for item in current_incidents["data"]["detections"][index]["filters"][filter]["tactics"]])\n                                \n                                elif k == "techniques":\n                                \n                                    if len(current_incidents["data"]["detections"][index]["filters"][filter]["techniques"]) > 1:\n                                        techniques = \';\'.join([str(item) for item in current_incidents["data"]["detections"][index]["filters"][filter]["techniques"]])\n                                    else:\n                                        techniques = \' \'.join([str(item) for item in current_incidents["data"]["detections"][index]["filters"][filter]["techniques"]])\n                                \n                                elif k == "highlightedObjects":\n                                    \n                                    if len(current_incidents["data"]["detections"][index]["filters"][filter]["highlightedObjects"]) > 1:\n                                        fld1 = []\n                                        value1 = []\n                                        highlights = []\n\n                                        for object in range(len(current_incidents["data"]["detections"][index]["filters"][filter]["highlightedObjects"])):\n                                            \n                                            for kye in current_incidents["data"]["detections"][index]["filters"][filter]["highlightedObjects"][object]:\n                                                if kye == "field":\n                                                    fieldName = current_incidents["data"]["detections"][index]["filters"][filter]["highlightedObjects"][object][kye]\n                                                    fld1.insert(1, fieldName)\n                                                elif kye == "value":\n                                                    valueName = current_incidents["data"]["detections"][index]["filters"][filter]["highlightedObjects"][object][kye]\n                                                    isArray = isinstance(valueName, list)\n                                                    if (isArray == True):\n                                                        valueName = \';\'.join([str(item) for item in valueName])\n                                                        valueName = valueName.replace(\'{\', \'\\{\')\n                                                        valueName = valueName.replace(\'}\', \'\\}\')\n                                                        valueName = valueName.replace(\'\\"\', \'\\\\\\\'\')\n                                                    else:\n                                                        valueName = str(valueName)\n                                                        valueName = valueName.replace(\'{\', \'\\{\')\n                                                        valueName = valueName.replace(\'}\', \'\\}\')\n                                                        valueName = valueName.replace(\'\\"\', \'\\\\\\\'\')\n                                                    value1.insert(1, valueName)\n\n                                        for flditems in range(len(fld1)):\n                                            highlighted = fld1[flditems] +"=\\"" + value1[flditems] + "\\""\n                                            highlights.insert(1, highlighted)\n\n                                        highlightedObj = \', \'.join([str(item) for item in highlights])\n                                        \n                                    else:\n                                        fld1 = current_incidents["data"]["detections"][index]["filters"][filter]["highlightedObjects"][0]["field"]\n                                        value1 = current_incidents["data"]["detections"][index]["filters"][filter]["highlightedObjects"][0]["value"]\n                                        value1 = value1.replace(\'{\', \'\\{\')\n                                        value1 = value1.replace(\'}\', \'\\}\')\n                                        value1 = value1.replace(\'\\"\', \'\\\\\\\'\')\n                                        highlightedObj = fld1 + "=\\"" + value1 + "\\""\n\n                # convert ISO8601 time format to unix timestamp\n\n                dp_detectetime = dp.parse(detection_time)\n                ut_detectedtime = int(time.mktime(dp_detectetime.timetuple()))\n                ut_detectedtime = str(ut_detectedtime)\n\n                message = str(now_log_time) + " tmxdr.customername.com, application=\\"trendmicroxdr-" + det_source + "\\", detectedutc=\\"" + ut_detectedtime + "\\", uuid=\\"" + uuid + "\\", endpoint=\\"" + endpoint_name + "\\", endpoint_guid=\\"" + endpoint_guid + "\\", endpoint_ip=\\"" + endpoint_ip + "\\", filter_id=\\"" + filter_id + "\\", filter_uid=\\"" + filter_uid + "\\", filter_level=\\"" + filter_level + "\\", filter_name=\\"" + filter_name + "\\", filter_description=\\"" + filter_description +"\\", tactics=\\"" + tactics + "\\", techniques=\\"" + techniques + "\\", " + highlightedObj\n\n                events.insert(-1, message)\n        current_incidents = {}\n\n        # write events to the log file \n        for i in range(len(events)):\n            with open(filepath, "a+") as file_log:\n            \n                file_log.seek(0)\n                data = file_log.read(100)\n                if len(data) > 0 :\n                    file_log.write("\\n")\n                file_log.write(events[i])\n        print(len(events))        \n\nif __name__ == "__main__":\n    while True:\n        doit()\n        time.sleep(300)\n'})}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",metastring:'title="/opt/tmcas/token.json"',children:'{"token_type":"Bearer","expires_in":"unknown","access":"MYBEARERTOKENHERE"}\n'})})]}),"\n",(0,i.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"https://www.youtube.com/watch?v=xK6XjzaWvX0",children:'"How to Create a Custom FileSpec for Log Collection using RSA NetWitness Platform"'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"https://www.youtube.com/playlist?list=PL69kuTXA1Iatq3MKjY3Ydw2J7GdMF8wKD",children:'"RSA NetWitness Platform \u201cHow To\u201d Informational Videos"'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"https://community.netwitness.com//t5/netwitness-platform-threat/log-parser-tool-v1-1-user-guide/ta-p/565941",children:'"Log Parser Tool v1.1 User Guide"'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"https://community.netwitness.com/t5/netwitness-knowledge-base/where-can-i-download-the-rsa-netwitness-log-parser-tool/ta-p/677455",children:'"Log Parser Tool v1.1.0"'}),(0,i.jsx)(n.a,{href:"https://disk.yandex.com/d/L9GbPudQQAuPAQ",children:"1"})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"https://disk.yandex.com/d/ecJYm4xzv23cfg",children:'"Log Parser Video Tutorials"'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"https://disk.yandex.com/d/p9zY_RRy7e4svA",children:'"Parsers Book"'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"https://disk.yandex.com/d/C7xPJU9cbP284Q",children:'"Parsers guides and stuffs"'})})]})}function d(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},2506:(e,n,t)=>{t.d(n,{A:()=>i});const i="data:image/png;base64,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"},8453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>l});var i=t(6540);const s={},r=i.createContext(s);function a(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);