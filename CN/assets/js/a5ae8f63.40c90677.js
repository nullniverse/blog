"use strict";(self.webpackChunknullniverseblog=self.webpackChunknullniverseblog||[]).push([[776],{3227:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>u,frontMatter:()=>o,metadata:()=>r,toc:()=>c});var r=t(7073),a=t(4848),s=t(8453);const o={slug:"pod-recurrent-restarts",title:"Pod Recurrent Restarts via Cronjobs",authors:["nullniverse"],tags:["blogging","kubernetes"]},i=void 0,l={authorsImageUrls:[void 0]},c=[];function m(e){const n={code:"code",em:"em",hr:"hr",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.p,{children:(0,a.jsx)(n.em,{children:"Ever wondered how to cycle your deployment/pods the native way? Think no more!"})}),"\n","\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-jsx",metastring:'title="Roles and account creation" showLineNumbers',children:'kubectl apply -f - <<EOF\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: deployment-restart\n  namespace: ns-name\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: Role\nmetadata:\n  name: deployment-restart\n  namespace: ns-name\nrules:\n  - apiGroups: ["apps", "extensions"]\n    resources: ["deployments"]\n    resourceNames: ["deployment-name"]\n    verbs: ["get", "patch", "list", "watch"]\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: RoleBinding\nmetadata:\n  name: deployment-restart\n  namespace: ns-name\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: Role\n  name: deployment-restart\nsubjects:\n  - kind: ServiceAccount\n    name: deployment-restart\n    namespace: ns-name\nEOF\n'})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-jsx",metastring:'title="Cronjob creation" showLineNumbers',children:'kubectl apply -f - <<EOF\napiVersion: batch/v1\nkind: CronJob\nmetadata:\n  name: deployment-restart\n  namespace: ns-name\nspec:\n  schedule: "* */5 * * *"\n  jobTemplate:\n    spec:\n      backoffLimit: 2\n      activeDeadlineSeconds: 600\n      template:\n        spec:\n          serviceAccountName: deployment-restart\n          containers:\n            - command:\n                - bash\n                - -c\n                - >-\n                  kubectl rollout restart deployment/deployment-name && kubectl rollout status deployment/deployment-name\n              image: bitnami/kubectl\n              imagePullPolicy: IfNotPresent\n              name: kubectl\n          restartPolicy: Never\nEOF\n'})})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(m,{...e})}):m(e)}},7073:e=>{e.exports=JSON.parse('{"permalink":"/CN/pod-recurrent-restarts","source":"@site/blog/2024-05-03-pod-recurrent-restarts/index.mdx","title":"Pod Recurrent Restarts via Cronjobs","description":"Ever wondered how to cycle your deployment/pods the native way? Think no more!","date":"2024-05-03T00:00:00.000Z","tags":[{"inline":true,"label":"blogging","permalink":"/CN/tags/blogging"},{"inline":true,"label":"kubernetes","permalink":"/CN/tags/kubernetes"}],"readingTime":0.755,"hasTruncateMarker":true,"authors":[{"name":"Nullniverse","title":"Vassal @ \u7279\u8d38 Cyber","url":"https://github.com/nullniverse","imageURL":"https://github.com/nullniverse.png","key":"nullniverse","page":null}],"frontMatter":{"slug":"pod-recurrent-restarts","title":"Pod Recurrent Restarts via Cronjobs","authors":["nullniverse"],"tags":["blogging","kubernetes"]},"unlisted":false,"nextItem":{"title":"Helm Chart Templating Tricks","permalink":"/CN/helm-chart-tricks"}}')},8453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>i});var r=t(6540);const a={},s=r.createContext(a);function o(e){const n=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);